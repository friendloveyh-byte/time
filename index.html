<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>자격검정 종료시간</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #f2f2f2;
            font-family: 'Pretendard', Arial, sans-serif;
            text-align: center;
        }

        .container {
            margin-top: 40px;
        }

        h1 {
            font-size: 48px;
            margin-bottom: 40px;
            font-weight: 700;
        }

        #currentTimeTop {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 30px;
        }

        .input-box {
            display: inline-block;
            width: 120px;
            height: 60px;
            font-size: 28px;
            text-align: center;
            border-radius: 12px;
            border: 2px solid #ccc;
            margin: 0 10px;
            background: #fff;
        }

        button {
            width: 180px;
            height: 60px;
            font-size: 28px;
            border: none;
            border-radius: 12px;
            margin-top: 30px;
            cursor: pointer;
        }

        .set-btn {
            background: #1ec64b;
            color: white;
        }

        .reset-btn {
            background: #d9534f;
            color: white;
            margin-top: 50px;
        }

        #currentTime {
            font-size: 46px;
            font-weight: 700;
            margin-top: 20px;
        }

        #endTime {
            font-size: 28px;
            color: gray;
            margin-top: 10px;
        }

        #remainLabel {
            font-size: 42px;
            margin-top: 50px;
            font-weight: 600;
        }

        #remainTime {
            font-size: 72px;
            color: red;
            font-weight: 800;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container" id="setup">
    <h1>자격검정 종료시간</h1>

    <div id="currentTimeTop">현재시간 : --시 --분 --초</div>

    <input id="hour" class="input-box" placeholder="시">
    <input id="minute" class="input-box" placeholder="분">

    <br>
    <button class="set-btn" onclick="setTime()">설정</button>
</div>

<div class="container" id="timer" style="display:none;">
    <div id="currentTime"></div>
    <div id="endTime"></div>

    <div id="remainLabel">남은시간</div>
    <div id="remainTime"></div>

    <button class="reset-btn" onclick="resetTimer()">재설정</button>
</div>

<script>
    let targetHour = null;
    let targetMinute = null;

    async function getKST() {
        try {
            const res = await fetch("https://worldtimeapi.org/api/timezone/Asia/Seoul");
            const data = await res.json();
            return new Date(data.datetime);
        } catch (e) {
            console.log("KST API 오류 → 로컬시간 사용", e);
            return new Date();
        }
    }

    async function updateCurrentTop() {
        const now = await getKST();

        document.getElementById("currentTimeTop").textContent =
            `현재시간 : ${now.getHours()}시 ${now.getMinutes()}분 ${now.getSeconds()}초`;
    }

    function setTime() {
        targetHour = parseInt(document.getElementById("hour").value);
        targetMinute = parseInt(document.getElementById("minute").value);

        if (isNaN(targetHour) || isNaN(targetMinute)) {
            alert("시간을 정확히 입력하세요.");
            return;
        }

        document.getElementById("setup").style.display = "none";
        document.getElementById("timer").style.display = "block";

        updateTimer();
        setInterval(updateTimer, 1000);
    }

    async function updateTimer() {
        const now = await getKST();

        const nowH = now.getHours();
        const nowM = now.getMinutes();
        const nowS = now.getSeconds();

        document.getElementById("currentTime").textContent =
            `현재시간 : ${nowH}시 ${nowM}분 ${nowS}초`;

        document.getElementById("endTime").textContent =
            `(종료시간 : ${targetHour}시 ${targetMinute}분)`;

        let end = new Date(now);
        end.setHours(targetHour);
        end.setMinutes(targetMinute);
        end.setSeconds(0);

        if (end < now) {
            end.setDate(end.getDate() + 1);
        }

        let diff = Math.floor((end - now) / 1000);

        let h = Math.floor(diff / 3600);
        let m = Math.floor((diff % 3600) / 60);
        let s = diff % 60;

        document.getElementById("remainTime").textContent =
            `${h}시간 ${m}분 ${s}초`;
    }

    function resetTimer() {
        document.getElementById("setup").style.display = "block";
        document.getElementById("timer").style.display = "none";
    }

    setInterval(updateCurrentTop, 1000);
    updateCurrentTop();
</script>

</body>
</html>
